!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],e):e((t=t||self).ReactLazyData={},t.React)}(this,(function(t,e){"use strict";function i(t){return s("string",t)}function n(t){return s("function",t)}function r(t){return i(t)&&!function(t){return""===t}(t)}function s(t,e){return function(t){return typeof t}(e)===t}function o(t,e){if(!t)throw new Error("Invariant failed")}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(){return(u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}var c={NO_SSR:"$_react-async-ssr/symbols.NO_SSR",ABORT:"$_react-async-ssr/symbols.ABORT",ON_MOUNT:"$_react-async-ssr/symbols.ON_MOUNT"},h=c.NO_SSR,_=c.ABORT,d=c.ON_MOUNT,l=function(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then};var f=0,v=1,p=4,y=["string","number","symbol"],b=function(){function t(t,e,i,n,r){var s=this;this._factory=t,this._req=e,this._cacheKey=i,this._context=n,this._parent=r,this._status=r?v:f,this._readStatus=0,this._isDisposed=!1,this._abort=void 0,this._children=[],this._numUndisposedChildren=0;var o=new Promise((function(t){s._resolve=t}));o[_]=this.dispose.bind(this),o[d]=this._mounted.bind(this),t._noSsr&&(o[h]=!0),this._value=o}var e,i,r,s=t.prototype;return s._load=function(){var t=this,e=this._parent;if(e)e._load();else if(this._status===f){var i=(0,this._factory._fetchFn)(this._req);l(i)||o(!1),this._status=v;var r=i.abort;n(r)&&(this._abort=r.bind(i)),i.then((function(e){return t._resolved(e)}),(function(e){return t._rejected(e)}))}},s._resolved=function(t){if(this._status===v){this._resolvedThis(t);for(var e=0,i=this._children;e<i.length;e++){var n=i[e],r=n.child,s=n.prop;this._resolveChild(r,s)}}},s._resolvedThis=function(t){this._status=2,this._value=t,this._abort=void 0,this._resolve()},s._resolveChild=function(t,e){var i=this._value;if(void 0!==e)try{i=i[e]}catch(e){return void t._rejected(e)}t._resolved(i)},s._rejected=function(t){if(this._status===v){this._status=3,this._value=t,this._abort=void 0,this._resolve();for(var e=0,i=this._children;e<i.length;e++){i[e].child._rejected(t)}}},s.read=function(){if(this._validateReadStatus(1),2===this._status)return this._value;throw this._value},s.dispose=function(){if(!this._isDisposed){this._isDisposed=!0;var t=this._parent;if(t)t._disposeFromChild();else{if([f,v].includes(this._status)){this._status=p;var e=this._abort;e&&(this._abort=void 0,e())}var i=this._cacheKey;void 0!==i&&this._factory._clearCacheEntry(i)}}},s.child=function(t){return y.includes(typeof t)||o(!1),this._child(t)},s.clone=function(){return this._child()},s._child=function(t){return this._childWithContext(t,this._context)},s._childWithContext=function(e,i){this._validateReadStatus(2);var n=new t(this._factory,this._req,this._cacheKey,i,this),r=this._status;return 2===r?this._resolveChild(n,e):3===r&&n._rejected(this._value),this._children.push({child:n,prop:e}),this._numUndisposedChildren++,n},s._disposeFromChild=function(){this._numUndisposedChildren--,0===this._numUndisposedChildren&&this.dispose()},s._validateReadStatus=function(t){var e=this._readStatus;0===e?this._readStatus=t:e!==t&&o(!1)},s._mounted=function(t){var e=this._context;e&&e.register(this,t)},e=t,(i=[{key:"isLoading",get:function(){return[f,v,p].includes(this._status)}},{key:"isLoaded",get:function(){return 2===this._status}},{key:"isErrored",get:function(){return 3===this._status}}])&&a(e.prototype,i),r&&a(e,r),t}();b.prototype["__react-lazy-data.IS_RESOURCE"]=!0;var C=e.createContext(),m={};function O(t){var e;(!s("object",e=t)||function(t){return null===t}(e))&&o(!1)}function R(t,e){var i=t.cacheVar;return null==i?e||"__react-lazy-data.DATA_CACHE":(r(i)||o(!1),i)}var w="undefined"==typeof window,g=function(){function t(t,e){var a,u,c,h;this._fetchFn=t,null!=e?(O(e),a=e.id,u=e.serialize,c=e.noSsr,null==a?a=void 0:(r(a)||o(!1),null==u?u=!0:!1===u&&o(!1),h=R(e)),null==u||!1===u?u=void 0:!0===u?u=JSON.stringify:(n(u)||o(!1),u=function(t){return function(e){var n=t(e);return i(n)||o(!1),n}}(u)),w&&u&&!a&&o(!1),null==c?c=!1:(s("boolean",c)||o(!1),w||(c=!1))):c=!1,this._id=a,this._serialize=u,this._noSsr=c,this._cacheVar=h,w?(this._cache=void 0,this._needContext=!!u):(this._cache=u?{}:void 0,this._needContext=!1)}var a=t.prototype;return a.create=function(t){return this._needContext&&o(!1),this._create(t)},a._create=function(t,e){var i=this._getResource(t,void 0,e);return this._noSsr||i._load(),i},a.use=function(t){if(w){var i=e.useContext(C);return!i&&this._needContext&&o(!1),this._create(t,i)}var n=e.useRef(),r=n.current;return r&&t===r._req||(r=this._getResource(t,r),n.current=r),e.useEffect((function(){return r._load(),function(){return r.dispose()}}),[r]),r},a._getResource=function(t,e,i){var n=this._serialize;if(!n)return new b(this,t,void 0,i);var r=n(t);if(e&&e._cacheKey===r)return e;var s=i?i.getCache(this):this._cache,o=s[r];return o||(o=new b(this,t,r),this._populateFromGlobalCache(o,r),s[r]=o),o._childWithContext(void 0,i)},a._clearCacheEntry=function(t){this._cache&&delete this._cache[t]},a._populateFromGlobalCache=function(t,e){if(!w){var i=this._id;if(i){var n=window[this._cacheVar];if(n){var r=n.data;if(r){var s=r[i];if(s&&s.hasOwnProperty(e)){var o=s[e];delete s[e],0===Object.keys(s).length&&delete r[i],t._resolvedThis(o)}}}}}},t}();function S(t){return null!=t&&!!t["__react-lazy-data.IS_RESOURCE"]&&n(t.read)}function j(t){for(var e in t=u({},t)){var i=t[e];S(i)&&(t[e]=i.read())}return t}t.createResourceFactory=function(t,e){return new g(t,e)},t.isResource=S,t.preloadData=function(t){return new Promise((function(e){var i=function(t,e){return null==t?t=m:O(t),R(t,e)}(t),n=window[i];n?e(n.data):(n=Object.create(null,{data:{configurable:!0,set:function(t){Object.defineProperty(n,"data",{value:t}),e(t)}}}),window[i]=n)}))},t.withResources=function(t){n(t)||o(!1);var i,r=n(i=t)&&i.prototype&&i.prototype.isReactComponent?function(t){return function(i){return i=j(i),e.createElement(t,i)}}(t):function(t){return function(e){e=j(e);for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return t.call.apply(t,[this,e].concat(n))}}(t);return Object.assign(r,t),r.displayName="withResources("+(t.displayName||t.name||"")+")",r},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=index.min.js.map
