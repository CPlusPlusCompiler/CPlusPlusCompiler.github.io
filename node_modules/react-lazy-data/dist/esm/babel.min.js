import{isFullString as e}from"is-it-type";import t from"tiny-invariant";import{D as r}from"./constants.min.js";import o from"babel-unique-id";import{pick as i}from"lodash";const n=t;function a(e,t,r,o){!function(e,t,r,o){const i=o.objectProperty(o.identifier(t),r);e.pushContainer("properties",i)}(e,t,o.stringLiteral(r),o)}export default function(t,s){let{cacheVar:p}=s;void 0===p||e(p)||n(!1),p===r&&(p=void 0);const c=i(s,["rootPath","isPackage","packageName","packageVersion","idLength"]);return{visitor:{CallExpression(e,i){!function(e,t,i,s,p){if(!e.get("callee").isIdentifier({name:"createResourceFactory"}))return;let c,l;if(e.node.arguments.length>1){c=e.get("arguments.1");const t=function(e){e.isObjectExpression()||n(!1);const t={};for(let r=0;r<e.node.properties.length;r++){const o=e.get(`properties.${r}`),i=o.get("key");i.isIdentifier()||n(!1);const a=o.get("value"),{value:s}=a.node;t[i.node.name]={propPath:o,valuePath:a,value:s}}return t}(c),{id:o,serialize:i,noSsr:a}=t;let s=t.cacheVar,p=!0,u=!1;if(o&&!o.valuePath.isStringLiteral()&&n(!1),a&&(a.valuePath.isBooleanLiteral()||n(!1),u=a.value,u||a.propPath.remove()),i){const{valuePath:e}=i;e.isBooleanLiteral()?(p=i.value,p&&!u&&i.propPath.remove()):e.isFunctionExpression()||e.isArrowFunctionExpression()||n(!1)}if(s&&(s.valuePath.isStringLiteral()||n(!1),l=s.value,""===l&&n(!1),l===r&&(s.propPath.remove(),s=void 0)),!p||u)return o&&o.propPath.remove(),void(s&&s.propPath.remove());if(o)return}else{const t=p.objectExpression([]);e.pushContainer("arguments",t),c=e.get("arguments.1")}const u=o(t,i);a(c,"id",u,p),l||(l=s,l&&a(c,"cacheVar",l,p))}(e,i,c,p,t.types)}}}}
//# sourceMappingURL=babel.min.js.map
